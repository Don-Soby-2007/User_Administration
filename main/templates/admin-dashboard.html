{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href='{% static "css/styles.css" %}'>
    <link rel="stylesheet" href='{% static "css/modal.css" %}'>
    <script>
        function createUser(){ alert('Create User clicked'); }
        function editUser(id){ alert('Edit user ' + id); }
        function deleteUser(id){ alert('Delete user ' + id); }
    </script>
    
</head>
<body class="admin-mgmt">
    <div class="background admin-mgmt-bg">
        <div class="geometric-pattern admin-mgmt-pattern"></div>
    </div>

    <a href="#" class="admin-mgmt-create" onclick=openCreateUser()>CREATE USER</a>
    <button class="logout-btn admin-mgmt-logout" onclick = window.location.href='{% url "logout" %}'>LOGOUT</button>

    <div class="login-container">
        <div class="login-panel admin-mgmt-panel">
            <h1 class="login-header admin-header" style="margin-bottom: 6px;">Admin Panel</h1>
            <p class="welcome-message" style="margin-bottom:18px;">Manage users below</p>

            <form methode='get'action="{% url 'admin_dashboard' %}" class="admin-mgmt-search" >
                <div class="input-group admin-input" style="flex:1;">
                    <span class="input-icon">ğŸ”</span>
                    <input type="text" name="q" value="{{query}}" id="user-search" placeholder="Search users...">
                </div>
                <button type="submit" class="btn-edit search-btn" title="Search">ğŸ”</button>
            </form>

            <table class="users-table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th style="text-align:right;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    
                    <tr>
                            <td>{{user.username}}</td>
                            <td>{{user.email}}</td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn-edit" onclick= "openEditUser( '{{user.id}}', '{{user.username}}', '{{user.email}}' )">Edit</button>
                                    <button class="btn-delete" onclick="deleteUser(1)">Delete</button>
                                </div>
                            </td>
                        </tr>
                        
                    {% endfor %}

                        
                </tbody>
            </table>
        </div>
    </div>

    <!-- Create User Modal -->
    <div id="createUserModal" class="cu-modal-overlay" onclick="if(event.target===this) closeCreateUser();">
        <div class="cu-modal">
            <div class="cu-modal-header">
                <h2>Create User</h2>
                <button class="cu-close" onclick="closeCreateUser()">Ã—</button>
            </div>
            <form class="cu-form" method="post" id='createUserForm'>
                {% csrf_token %}
                <div class="input-group admin-input">
                    <span class="input-icon">ğŸ‘¤</span>
                    <input type="text" placeholder="Username" name="username" required>
                </div>
                <div class="input-group admin-input">
                    <span class="input-icon">ğŸ“§</span>
                    <input type="email" placeholder="Email" name="email" required>
                </div>
                <div class="input-group admin-input">
                    <span class="input-icon">ğŸ”’</span>
                    <input type="password" placeholder="Password" name="password" required>
                </div>
                <div class="input-group admin-input">
                    <span class="input-icon">ğŸ”’</span>
                    <input type="password" placeholder="Confirm Password" name="confirm_password" required>
                </div>
                <div>
                    <div id='errorMessage' class="password-error" style="display:none;">Passwords do not match. Please try again.</div>
                </div>
                <div class="cu-actions">
                    <button type="button" class="cu-btn cu-cancel" onclick="closeCreateUser()">Cancel</button>
                    <button type="submit" class="cu-btn cu-submit">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="cu-modal-overlay" onclick="if(event.target===this) closeEditUser();">
        <div class="cu-modal">
            <div class="cu-modal-header">
            <h2>Edit User</h2>
            <button class="cu-close" onclick="closeEditUser()">Ã—</button>
            </div>

            <form id="editUserForm" class="cu-form">
            {% csrf_token %}
            <input type="hidden" name="user_id" id="editUserId">

            <div class="input-group admin-input">
                <span class="input-icon">ğŸ‘¤</span>
                <input type="text" name="username" id="editUsername" placeholder="Username" required>
            </div>

            <div class="input-group admin-input">
                <span class="input-icon">ğŸ“§</span>
                <input type="email" name="email" id="editEmail" placeholder="Email" required>
            </div>

            <div class="input-group admin-input" style="display:flex; align-items:center; gap:10px;">
                <input type="checkbox" id="editMakeAdmin" name="make_admin" style="width:18px; height:18px;">
                <label for="editMakeAdmin" style="color:white; cursor:pointer;">Make as Admin</label>
            </div>

            <div id="editError" class="password-error" style="display:none;"></div>

            <div class="cu-actions">
                <button type="button" class="cu-btn cu-cancel" onclick="closeEditUser()">Cancel</button>
                <button type="submit" class="cu-btn cu-submit">Save Changes</button>
            </div>
            </form>
        </div>
    </div>

    
    <script>
        const createUserUrl = "{% url 'create_user' %}";
        const editUserUrl = "{% url 'edit_user' %}";
    </script>
    <script src="{% static 'js/script.js' %}"></script>
    
</body>
</html>